```markdown
---
output: github_document
---
<!-- README.md is generated from README.Rmd. Please edit that file -->
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# KeRnel: A Comprehensive R Package for Kernel Methods

<!-- badges: start -->
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![R-CMD-check](https://github.com/terenceviellard/kernels/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/terenceviellard/kernels/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/kernels)](https://CRAN.R-project.org/package=kernels)
<!-- badges: end -->

**KeRnel** is a comprehensive R package designed for working with kernel methods in machine learning, Bayesian inference, and statistical modeling. It provides a flexible framework for implementing, combining, and optimizing various types of kernels with a clean object-oriented interface.

## Features

- **Multiple Kernel Types**: Implements common kernel functions including Squared Exponential, Matern, Periodic, Rational Quadratic, Linear, Constant, and Noise kernels
- **Kernel Operations**: Supports summation and multiplication of kernels to create complex composite kernels
- **Hyperparameter Optimization**: Built-in optimization using L-BFGS-B algorithm
- **Analytical Derivatives**: Computes derivatives of kernels with respect to hyperparameters
- **Visualization Tools**: Functions for visualizing kernel matrices and behavior
- **Extensible Architecture**: Easy to add custom kernel implementations

## Installation

You can install the development version of KeRnel from GitHub with:

``` r
# install.packages("devtools")
devtools::install_github("terenceviellard/kernels")
```

Or install the released version from CRAN (if available):

``` r
install.packages("kernels")
```

## Basic Usage

### Creating and Using Kernels

First, load the package and create some sample data:

```{r}
library(keRnel)

# Generate sample data
set.seed(123)
x <- matrix(rnorm(50), ncol = 2)
```

### Core Kernel Types

The package implements several fundamental kernel types:

1. **Squared Exponential (RBF) Kernel**:
   $$K_{\text{SE}}(x, x') = \sigma^2 \exp\left(-\frac{\|x - x'\|^2}{2\ell^2}\right)$$

```{r}
se_kernel <- new("SEKernel", variance_se = 1.0, length_scale_se = 1.0)
pretty_print(se_kernel)


```

```{r}
K_se <- pairwise_kernel(se_kernel, x, x)
head(K_se)
```

2. **Matern Kernels** (with different smoothness parameters):
   - Matern 1/2:
     $$K_{\text{Mat}_{1/2}}(x, x') = \sigma^2 \exp\left(-\frac{\|x - x'\|}{\ell}\right)$$
   - Matern 3/2:
     $$K_{\text{Mat}_{3/2}}(x, x') = \sigma^2 \left(1 + \frac{\sqrt{3}\|x - x'\|}{\ell}\right)\exp\left(-\frac{\sqrt{3}\|x - x'\|}{\ell}\right)$$
   - Matern 5/2:
     $$K_{\text{Mat}_{5/2}}(x, x') = \sigma^2 \left(1 + \frac{\sqrt{5}\|x - x'\|}{\ell} + \frac{5\|x - x'\|^2}{3\ell^2}\right)\exp\left(-\frac{\sqrt{5}\|x - x'\|}{\ell}\right)$$

```{r}
matern12 <- new("MaternKernel12", length_scale_mat = 1.0)
matern32 <- new("MaternKernel32", length_scale_mat = 1.0)
matern52 <- new("MaternKernel52", length_scale_mat = 1.0)
```

3. **Periodic Kernel**:
   $$K_{\text{Per}}(x, x') = \sigma^2 \exp\left(-\frac{2\sin^2(\pi\|x - x'\|/p)}{\ell^2}\right)$$

```{r}
periodic_kernel <- new("PeriodicKernel", variance_per = 1.0,
                      length_scale_per = 1.0, period = 1.0)
```

4. **Rational Quadratic Kernel**:
   $$K_{\text{RQ}}(x, x') = \sigma^2 \left(1 + \frac{\|x - x'\|^2}{2\alpha\ell^2}\right)^{-\alpha}$$

```{r}
rq_kernel <- new("RationalQuadraticKernel", variance_rq = 1.0,
                length_scale_rq = 1.0, alpha_rq = 1.0)
```

5. **Linear Kernel**:
   $$K_{\text{Lin}}(x, x') = \sigma_b^2 + \sigma_v^2(x-c)(x'-c)$$

```{r}
linear_kernel <- new("LinearKernel", sigma2_b = 1.0, sigma2_v = 1.0, c = 0.0)
```

### Kernel Composition

Kernels can be combined using sum and product operations:

```{r}
# Sum of kernels
sum_kernel <- se_kernel + matern32
pretty_print(sum_kernel)
# Product of kernels
product_kernel <- se_kernel * periodic_kernel
pretty_print(product_kernel)

```

```{r}
# Compute with composite kernels
K_sum <- pairwise_kernel(sum_kernel, x, x)
K_product <- pairwise_kernel(product_kernel, x, x)
head(K_product)
```

### Kernel Visualization

The package includes visualization functions:

```{r}
# Visualize kernel matrix
visualize_kernel(se_kernel, x)

# Plot kernel values vs distance
plot_kernel_vs_distance(se_kernel, seq(-5, 5, length.out = 100))
```

## Hyperparameter Optimization

KeRnel provides tools for optimizing kernel hyperparameters:

```{r}
# Generate sample data for optimization
y <- rnorm(25)

# Optimize hyperparameters
optim_result <- optim_hp_L_BFGS_B(
  hp = c(variance_se = 1.0, length_scale_se = 1.0),
  db = list(Input = x[1:25, ], Output = y),
  mean = 0,
  kern = se_kernel,
  post_cov = 1e-6 * diag(25)
)

# View optimized parameters
print(optim_result)
```

### Using Optimized Parameters

```{r}
# Update kernel with optimized parameters
se_kernel_updated = set_hyperparameters(se_kernel, optim_result)
K_optimized <- pairwise_kernel(se_kernel_updated, x, x)


```

```{r}
visualize_kernel(se_kernel_updated, x)

plot_kernel_vs_distance(se_kernel_updated, seq(-5, 5, length.out = 100))
```

## Kernel Derivatives

Compute derivatives of kernels with respect to hyperparameters:

```{r}
# Compute derivative with respect to length scale
dK_dtheta <- kernel_deriv(se_kernel, x[1:10, ], x[1:10, ], "length_scale_se")

head(dK_dtheta)
```

## Advanced Features

### Custom Kernel Implementation

The package is designed to be extensible. You can implement your own kernel types by inheriting from the `AbstractKernel` class:

```{r}
# Example of custom kernel implementation would go here
```

### Kernel Utilities

The package includes several utility functions:

```{r}
# Get hyperparameter names and values
hyp_names <- get_hyperparameter_names(se_kernel)
print(hyp_names)
hyp_values <- get_hyperparameter_values(se_kernel)
print(hyp_values)

pretty_print(se_kernel)
```

## Examples

### Complete Workflow Example

Here's a complete example from data generation to visualization:

```{r}
# Set seed for reproducibility
set.seed(456)

# 1. Generate sample data
x_example <- seq(-10, 10, length.out = 100)
y_example <- sin(x_example) + rnorm(100, sd = 0.2)

# 2. Create and optimize kernel
kernel <- new("SEKernel", variance_se = 1.0, length_scale_se = 1.0)

optimized <- optim_hp_L_BFGS_B(
  hp = c(variance_se = 1.0, length_scale_se = 1.0),
  db = list(Input = matrix(x_example, ncol = 1), Output = y_example),
  mean = 0,
  kern = kernel,
  post_cov = 1e-6 * diag(100)
)

# 3. Visualize results
visualize_kernel(kernel, matrix(x_example, ncol = 1))
plot_kernel_vs_distance(kernel, x_example)
```

## Getting Help

- Browse the package vignettes: `browseVignettes("kernels")`
- View function documentation: `?SEKernel`, `?optim_hp_L_BFGS_B`
- For issues and feature requests: [GitHub Issues](https://github.com/terenceviellard/kernels/issues)

## License

This package is released under the GPL-3 license.


```

